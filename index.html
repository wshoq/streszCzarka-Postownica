<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>streszCzarka</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: auto;
      padding: 2rem;
      background: #f7f7f7;
      text-align: center;
    }
    h1 {
      margin-bottom: 2rem;
    }
    .links {
      display: flex;
      justify-content: center;
      gap: 3rem;
      margin-bottom: 2rem;
    }
    .link-button {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      color: #fff;
      background-color: #dc3545;
      padding: 1.5rem 2rem;
      border-radius: 10px;
      font-size: 1.5rem;
      width: 180px;
      transition: background-color 0.3s;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
      user-select: none;
    }
    .link-button:hover {
      background-color: #b02a37;
    }
    .date-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    .date-controls button {
      font-size: 1.5rem;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      background-color: #6c757d;
      color: white;
      cursor: pointer;
      user-select: none;
    }
    .date-controls button:hover {
      background-color: #5a6268;
    }
    input[type="date"] {
      font-size: 1.2rem;
      padding: 0.5rem;
      width: 180px;
    }
    #posts {
      background: white;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      min-height: 200px;
      text-align: left;
    }
    article {
      margin-bottom: 2rem;
    }
    article h2 {
      margin-top: 0;
      color: #333;
    }
    article h3 {
      margin-bottom: 0.5rem;
      color: #555;
    }
    article p {
      margin: 0.5rem 0;
      line-height: 1.5;
    }
    article hr {
      border: none;
      border-top: 1px solid #ddd;
      margin: 1rem 0;
    }
    article a {
      color: #007bff;
      text-decoration: none;
    }
    article a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>Wa≈õƒá Wasza Cyfrowa</h1>

  <div class="links">
    <a href="uran.html" class="link-button" aria-label="Market Dashboard">
      <span class="icon">üìä</span>
      Market dashboard
    </a>
    <!-- Wod√≥r usuniƒôty -->
  </div>

  <div class="date-controls">
    <button id="prevDayBtn">‚Üê</button>
    <input type="date" id="datePicker" />
    <button id="nextDayBtn">‚Üí</button>
  </div>

  <div id="posts">Wybierz datƒô, aby zobaczyƒá artyku≈Çy.</div>

  <script>
    const SUPABASE_URL = "https://uybpjjqvtcpsxihpbhlp.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV5YnBqanF2dGNwc3hpaHBiaGxwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA0MzMxOTksImV4cCI6MjA2NjAwOTE5OX0.t2amEymFNyEr7bEZ4_p5qX5zxdpx60m3vlyyj2uZkdc";

    const datePicker = document.getElementById('datePicker');
    const container = document.getElementById('posts');
    const prevDayBtn = document.getElementById('prevDayBtn');
    const nextDayBtn = document.getElementById('nextDayBtn');

    function parseTitleDateToISO(titleDate) {
      const [datePart] = titleDate.split(',');
      const [day, month, year] = datePart.trim().split('.');
      return `${year}-${month.padStart(2,'0')}-${day.padStart(2,'0')}`;
    }

    function markdownLinksToHTML(text) {
      return text.replace(/\[([^\]]+)\]\((https?:\/\/[^\)]+)\)/g, '<a href="$2" target="_blank">$1</a>');
    }

    function formatContentForHTML(text) {
      // Zamie≈Ñ --- na <hr>
      let html = text.replace(/---/g, '<hr />');
      // Podziel po podw√≥jnych enterach
      html = html.split(/\n{2,}/)
        .map(block => block.trim())
        .filter(Boolean)
        .map(block => `<p>${markdownLinksToHTML(block)}</p>`)
        .join('');
      return html;
    }

    function fetchPosts() {
      container.innerHTML = "≈Åadowanie...";

      fetch(`${SUPABASE_URL}/rest/v1/posts?select=title,content&order=title.desc&limit=100`, {
        headers: {
          apikey: SUPABASE_KEY,
          Authorization: `Bearer ${SUPABASE_KEY}`,
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        }
      })
      .then(res => res.ok ? res.json() : Promise.reject(`B≈ÇƒÖd sieci: ${res.status}`))
      .then(posts => {
        const selectedDate = datePicker.value;
        if (!selectedDate) {
          container.innerHTML = '<p>Wybierz datƒô, aby zobaczyƒá artyku≈Çy.</p>';
          return;
        }

        const filteredPosts = posts.filter(post => {
          if (!post.title) return false;
          const postDateISO = parseTitleDateToISO(post.title);
          return postDateISO === selectedDate;
        });

        if (filteredPosts.length === 0) {
          container.innerHTML = `<p>Brak artyku≈Ç√≥w na dzie≈Ñ ${selectedDate}.</p>`;
          return;
        }

        container.innerHTML = '';
        filteredPosts.forEach(post => {
          const contentHTML = formatContentForHTML(post.content);
          container.innerHTML += `<article><h2>${post.title}</h2>${contentHTML}</article>`;
        });
      })
      .catch(err => {
        console.error(err);
        container.innerHTML = `<p>B≈ÇƒÖd podczas ≈Çadowania post√≥w: ${err}</p>`;
      });
    }

    function shiftDate(days) {
      const current = new Date(datePicker.value);
      current.setDate(current.getDate() + days);
      const iso = current.toISOString().split('T')[0];
      datePicker.value = iso;
      fetchPosts();
    }

    prevDayBtn.addEventListener('click', () => shiftDate(-1));
    nextDayBtn.addEventListener('click', () => shiftDate(1));
    datePicker.addEventListener('change', fetchPosts);

    // ustaw datƒô dzisiejszƒÖ na starcie i ≈Çaduj posty
    const today = new Date().toISOString().slice(0, 10);
    datePicker.value = today;
    fetchPosts();
  </script>
</body>
</html>
