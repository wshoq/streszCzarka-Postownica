<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<title>üìä Dashboard Markets</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:1rem; background:#f4f4f9; color:#333; }
h1 { text-align:center; margin-bottom:1rem; }
.grid { display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
table { width:100%; border-collapse:collapse; background:white; border-radius:8px; overflow:hidden; box-shadow:0 2px 6px rgba(0,0,0,0.1); margin-bottom:2rem; }
th, td { padding:0.5rem 0.75rem; border-bottom:1px solid #ddd; text-align:left; vertical-align: middle; }
th { background:#f0f0f0; }
tr:last-child td { border-bottom:none; }
.positive { color:green; font-weight:bold; }
.negative { color:red; font-weight:bold; }
.unit { font-size:0.82em; color:#666; font-weight:normal; margin-left:6px; }
.small { font-size:0.9em; color:#555; }
/* Styl przycisku powrotu */
.back-btn { display:inline-block; margin-bottom:0.5rem; padding:0.35rem 0.75rem; font-size:0.85rem; background:#e0e0e0; color:#333; border:none; border-radius:6px; cursor:pointer; text-decoration:none; transition:background 0.2s ease; }
.back-btn:hover { background:#ccc; }
/* Styl przycisk√≥w walor√≥w */
.item-btn { background:none; border:none; color:#333; font-weight:bold; cursor:pointer; padding:0; font-family: inherit; }
.item-btn:hover { text-decoration:underline; }
</style>
</head>
<body>
<h1>üìä Dashboard Markets</h1>
<div class="grid">
<div>
  <!-- przycisk powrotu -->
  <a href="index.html" class="back-btn">‚Üê Powr√≥t do streszCzarki</a>
  <h2>üìà Indeksy</h2>
  <table id="indexes-table">
    <thead>
      <tr><th>Nazwa</th><th>Cena</th><th>Zmiana (nom.)</th><th>Zmiana (%)</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
<div>
  <h2>üí± Waluty & Obligacje</h2>
  <table id="markets-table">
    <thead>
      <tr><th>Nazwa</th><th>Warto≈õƒá</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
</div>
<h2>‚öíÔ∏è Surowce</h2>
<table id="commodities-table">
<thead>
<tr>
<th>Nazwa</th><th>Cena</th><th>Daily</th><th>Change (%)</th>
<th>Weekly</th><th>Monthly</th><th>YTD</th><th>YoY</th><th>Data</th>
</tr>
</thead>
<tbody></tbody>
</table>
<script>
const flagMap = {
"USD": "üá∫üá∏", "EUR": "üá™üá∫", "PLN": "üáµüá±", "CHF": "üá®üá≠", "GBP": "üá¨üáß",
"JPY": "üáØüáµ", "BTC": "‚Çø", "Nikkei": "üáØüáµ", "Hang Seng": "üá≠üá∞",
"DAX": "üá©üá™", "S&P": "üá∫üá∏", "Dow Jones": "üá∫üá∏", "Nasdaq": "üá∫üá∏"
};

const linkMap = {
"DAX":"https://tradingeconomics.com/germany/stock-market",
"Nikkei":"https://tradingeconomics.com/japan/stock-market",
"Hang Seng":"https://tradingeconomics.com/hong-kong/stock-market",
"S&P":"https://tradingeconomics.com/spx:ind",
"Nasdaq":"https://tradingeconomics.com/ndaq:us",
"Dow Jones":"https://tradingeconomics.com/united-states/dow-jones-industrial-average-fed-data.html",
"USD/PLN":"https://tradingeconomics.com/usdpln:cur",
"EUR/USD":"https://tradingeconomics.com/eurusd:cur",
"CHF/PLN":"https://tradingeconomics.com/chfpln:cur",
"BTC/USD":"https://www.coingecko.com/en/coins/bitcoin",
"US 10Y Bond":"https://tradingeconomics.com/united-states/government-bond-yield",
"Gold":"https://tradingeconomics.com/commodity/gold",
"Silver":"https://tradingeconomics.com/commodity/silver",
"Platinum":"https://tradingeconomics.com/commodity/platinum",
"Copper":"https://tradingeconomics.com/commodity/copper",
"Neodymium":"https://tradingeconomics.com/commodity/neodymium",
"Uranium":"https://tradingeconomics.com/commodity/uranium"
};

function addFlag(title) {
  for (const key in flagMap) {
    if (title.includes(key)) return flagMap[key] + " " + title;
  }
  return title;
}

function renderColored(value, forceSign = null){
  if (!value || value === '‚Äî') return '‚Äî';
  const cleaned = value.replace(/\s/g,'').replace(',','.').replace('%','');
  let n = parseFloat(cleaned);
  if (isNaN(n)) return value;
  if (forceSign === "+") n = Math.abs(n);
  if (forceSign === "-") n = -Math.abs(n);
  if (n > 0) return `<span class="positive">${value}</span>`;
  if (n < 0) return `<span class="negative">${value}</span>`;
  return value;
}

function parseDate(dateStr) {
  if (!dateStr) return '‚Äî';
  const parts = dateStr.split('/');
  if (parts.length !== 2) return dateStr;
  const [mon, day] = parts;
  const monthMap = {Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"};
  const month = monthMap[mon] || "01";
  const dayStr = day.padStart(2,'0');
  const yearShort = new Date().getFullYear().toString().slice(-2);
  return `${dayStr}.${month}.${yearShort}`;
}

// Funkcja generujƒÖca przycisk z linkiem
function makeLinkButton(title) {
  const key = Object.keys(linkMap).find(k => title.includes(k));
  const href = key ? linkMap[key] : "#";
  return `<button class="item-btn" onclick="window.open('${href}','_blank')">${title}</button>`;
}

// Przyk≈Çadowe dane do demonstracji
const demoRows = [
  {title:"DAX", content:": 15350 pkt, zmiana +50 (+0,33%)"},
  {title:"Nikkei", content:": 30500 pkt, zmiana -120 (-0,39%)"},
  {title:"USD/PLN", content:"4.34"},
  {title:"Gold", content:"Price: 1920 | Daily: +15 | Change: +0.79% | Weekly: +0.5 | Monthly: +1.2 | YTD: +3.2 | YoY: +7.8 | Date: Sep/25"}
];

function fetchDashboard() {
  try {
    const idxBody = document.querySelector("#indexes-table tbody");
    const marketsBody = document.querySelector("#markets-table tbody");
    const commBody = document.querySelector("#commodities-table tbody");
    idxBody.innerHTML = ""; marketsBody.innerHTML = ""; commBody.innerHTML = "";

    demoRows.forEach(row => {
      const title = row.title;
      const content = (row.content || "").trim();

      // Surowce
      if (content.includes("Price:")) {
        let rawName = title; 
        let rest = content;
        if (content.includes("‚Üí")) { const split = content.split("‚Üí"); rawName = split[0].trim(); rest = split[1].trim(); }
        const parts = {};
        rest.split("|").map(x=>x.trim()).forEach(pair=>{ const ix = pair.indexOf(':'); if(ix>-1){ const k = pair.slice(0,ix).trim(); const v = pair.slice(ix+1).trim(); parts[k]=v;}});
        const price = parts["Price"] ?? '‚Äî';
        const daily = parts["Daily"] ?? '‚Äî';
        const change = parts["Change"] ?? '‚Äî';
        const weekly = parts["Weekly"] ?? '‚Äî';
        const monthly = parts["Monthly"] ?? '‚Äî';
        const ytd = parts["YTD"] ?? '‚Äî';
        const yoy = parts["YoY"] ?? '‚Äî';
        const date = parts["Date"] ? parseDate(parts["Date"]) : '‚Äî';
        const match = rawName.match(/(.+?)\s*\((.+?)\)$/);
        let displayName = makeLinkButton(rawName);
        commBody.insertAdjacentHTML('beforeend',
          `<tr>
          <td>${displayName}</td><td class="small">${price}</td>
          <td class="small">${renderColored(daily)}</td>
          <td class="small">${renderColored(change)}</td>
          <td class="small">${renderColored(weekly)}</td>
          <td class="small">${renderColored(monthly)}</td>
          <td class="small">${renderColored(ytd)}</td>
          <td class="small">${renderColored(yoy)}</td>
          <td class="small">${date}</td>
          </tr>`);
        return;
      }

      // Indeksy
      const idxRegex = /:\s*([\d\s.,]+)\s*pkt, zmiana\s*([+\-]?\d[\d\s.,]*)\s*\(([-+]?\d[\d\s.,]*%)\)/i;
      const m = content.match(idxRegex);
      if (m) {
        const priceRaw = m[1].trim(); const nominalRaw = m[2].trim(); const percentRaw = m[3].trim();
        const sign = nominalRaw.includes("-")?"-":nominalRaw.includes("+")?"+":null;
        idxBody.insertAdjacentHTML('beforeend',
          `<tr>
          <td>${makeLinkButton(addFlag(title))}</td>
          <td class="small">${priceRaw}</td>
          <td class="small">${renderColored(nominalRaw)}</td>
          <td class="small">${renderColored(percentRaw, sign)}</td>
          </tr>`);
        return;
      }

      // Waluty / Obligacje
      const valCandidate = content.replace(/\s/g,'').replace(',', '.');
      if(valCandidate!=="" && !isNaN(Number(valCandidate))){
        let value = content;
        marketsBody.insertAdjacentHTML('beforeend',
          `<tr>
          <td>${makeLinkButton(addFlag(title))}</td>
          <td class="small">${value}</td>
          </tr>`);
        return;
      }
    });
  } catch(err) { console.error(err); }
}

fetchDashboard();
setInterval(fetchDashboard,60000);
</script>
</body>
</html>
